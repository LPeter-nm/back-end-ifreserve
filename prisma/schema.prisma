generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SYSTEM_ADMIN
  PE_ADMIN // Professores de Educação Física
  USER
}

enum ServerFunction {
  PROFESSOR_EDUCACAO_FISICA
  PROFESSOR_OUTROS
  DIRETOR
  COORDENADOR
  OUTRO
}

enum Type_User {
  ALUNO
  SERVIDOR
  EXTERNO
}

enum StatusUser {
  ATIVO
  INATIVO
}


enum StatusRestore {
  CONCLUIDO
  PENDENTE
}

enum StatusSport {
  PENDENTE
  CONFIRMADA
  RECUSADA
  CANCELADA
}

enum Type_Reserve {
  OFICIO
  EVENTO 
  AULA
}

enum Type_Practice {
  TREINO
  RECREACAO
  AMISTOSO
}

enum Occurrence {
  EVENTO_UNICO
  SEMANALMENTE
}


// Tabela usuário
model User {
  id String @id @default(uuid())
  name String
  identification String @unique
  email String @unique
  password String
  type_User Type_User @default(ALUNO)
  role Role @default(USER)
  status StatusUser? @default(ATIVO)
  createdAt DateTime @default(now()) @map("created_at")

  // Relacionamentos
  server Server?
  student Student?
  userExternal User_External?
  notifications Notification[]
  restores Restore[]
  reserves Reserve[]

  @@index([email])
  @@index([createdAt])
}

// Tabela usuário interno 
model Server {
  id String @id @default(uuid())
  roleInInstitution ServerFunction
  userId String @unique @map("userId")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model Student {
  id String @id @default(uuid())
  userId String @unique @map("userId")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

}

// Tabela usuário externo
model User_External {
  id String @id @default(uuid())
  phone String?
  address String?
  userId String @unique

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

// Tabela restauração de senha
model Restore {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token        String
  used         Boolean  @default(false)
  createdAt    DateTime @default(now()) @map("created_at")
  expirationAt DateTime @map("updated_at")

  @@map("restores")
}

model Reserve {
  id String @id @default(uuid())
  type_Reserve Type_Reserve @default(OFICIO)
  occurrence Occurrence
  dateTimeStart DateTime
  dateTimeEnd DateTime
  userId String 
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  sport Sport?
  classroom Classroom?
  event Event?
  @@index([userId])
}

model Sport {
  id String @id @default(uuid())
  type_Practice Type_Practice 
  number_People Int 
  participants String 
  request_Equipment String
  status StatusSport @default(PENDENTE)
  anseweredBy String?
  comments String?
  completed Boolean?

  reserve Reserve @relation(fields: [reserveId], references: [id], onDelete: Cascade)
  reserveId String @unique

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  report Report?
}

model Classroom {
  id String @id @default(uuid())
  course String
  matter String
  reserveId String @unique

  reserve Reserve @relation(fields: [reserveId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model Event {
  id String @id @default(uuid())
  name String
  description String
  location String
  reserveId String @unique

  reserve Reserve @relation(fields: [reserveId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model Report {
  id String @id @default(uuid())
  name_User String 
  people_Appear String
  requested_Equipment String
  description_Court String
  description_Equipment String
  time_Used String
  date_Used DateTime
  description String?
  comments String?
  status Boolean @default(false)
  sportId String @unique

  sport Sport @relation(fields: [sportId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

}

model Notification {
  id String @id @default(uuid())
  message String
  description String
  userId String
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")
}